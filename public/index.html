<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Server Administration Dashboard">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Server Administration</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="/favicon.jpg">
    
    <!-- External Libraries -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <style>
        /* ==========================================
           RESET & BASE STYLES
           ========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: 'Courier New', 'Monaco', monospace;
            background: #000000;
            min-height: 100vh;
            color: #ffffff;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            line-height: 1.5;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        /* ==========================================
           LAYOUT STRUCTURE
           ========================================== */
        .container {
            max-width: 100%;
            margin: 0;
            padding: 1% 3%;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #ffffff;
            border-bottom: 2px solid #333333;
            padding-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffffff;
            font-weight: normal;
        }

        .header p {
            font-size: 1.1rem;
            color: #cccccc;
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        /* ==========================================
           CARD COMPONENTS
           ========================================== */

        .card {
            background: #111111;
            border: 1px solid #333333;
            padding: 20px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
            width: 100%;
        }

        /* Responsive Cards */
        @media (max-width: 1200px) {
            .card {
                padding: 18px;
            }
        }

        @media (max-width: 768px) {
            .card {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 12px;
            }
        }

        .card:hover {
            border-color: #666666;
        }

        .card h2 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.2rem;
            border-bottom: 1px solid #333333;
            padding-bottom: 10px;
            font-weight: normal;
        }

        /* Responsive Card Headings */
        @media (max-width: 768px) {
            .card h2 {
                font-size: 1.1rem;
                margin-bottom: 15px;
                padding-bottom: 8px;
            }
        }

        @media (max-width: 480px) {
            .card h2 {
                font-size: 1rem;
                margin-bottom: 12px;
                padding-bottom: 6px;
            }
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: #222222;
            border: 1px solid #333333;
        }

        /* Responsive Metrics */
        @media (max-width: 768px) {
            .metric {
                padding: 6px;
                margin-bottom: 8px;
            }
        }

        @media (max-width: 480px) {
            .metric {
                padding: 5px;
                margin-bottom: 6px;
                font-size: 0.9rem;
            }
        }

        .metric-label {
            font-weight: normal;
            color: #cccccc;
        }

        .metric-value {
            font-weight: bold;
            color: #ffffff;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #333333;
            overflow: hidden;
            margin-top: 5px;
            border: 1px solid #444444;
        }

        .progress-fill {
            height: 100%;
            background: #ffffff;
            transition: width 0.3s ease;
        }

        /* Small cards container - display in a row */
        .small-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .small-cards-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .small-cards-container {
                gap: 12px;
            }
        }

        .terminal-container {
            background: #000000;
            border: 1px solid #333333;
            padding: 1%;
            height: 50vh;
            min-height: 300px;
            max-height: 600px;
            overflow: hidden;
        }

        /* Responsive Terminal */
        @media (max-width: 1200px) {
            .terminal-container {
                height: 45vh;
                min-height: 250px;
            }
        }

        @media (max-width: 768px) {
            .terminal-container {
                height: 40vh;
                min-height: 200px;
                padding: 0.8%;
            }
        }

        @media (max-width: 480px) {
            .terminal-container {
                height: 35vh;
                min-height: 150px;
                padding: 0.5%;
            }
        }

        #terminal {
            height: 100%;
        }
        
        /* Terminal Tabs */
        .terminal-tabs {
            display: flex;
            border-bottom: 1px solid #333333;
            background: #111111;
            overflow-x: auto;
            justify-content: space-between;
        }
        
        .terminal-tabs-container {
            display: flex;
            overflow-x: auto;
            flex: 1;
        }
        
        .terminal-add-tab-btn {
            padding: 8px 16px;
            background: #222222;
            border: 1px solid #333333;
            border-bottom: none;
            color: #ffffff;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
            transition: all 0.3s ease;
            font-family: 'Courier New', 'Monaco', monospace;
        }
        
        .terminal-add-tab-btn:hover {
            background: #2a2a2a;
            border-color: #555555;
        }
        
        .terminal-fullscreen-btn {
            padding: 8px 16px;
            background: #222222;
            border: 1px solid #333333;
            border-bottom: none;
            color: #ffffff;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
            transition: all 0.3s ease;
            font-family: 'Courier New', 'Monaco', monospace;
        }
        
        .terminal-fullscreen-btn:hover {
            background: #2a2a2a;
            border-color: #555555;
        }
        
        /* Fullscreen terminal styles */
        .terminal-fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
        }
        
        .terminal-fullscreen-mode .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000000;
        }
        
        .terminal-fullscreen-mode .terminal-content {
            flex: 1;
            height: 100%;
        }
        
        .terminal-fullscreen-mode .terminal-tabs {
            border-bottom: 2px solid #333333;
        }
        
        .terminal-tab {
            padding: 0;
            background: #222222;
            border: 1px solid #333333;
            border-bottom: none;
            color: #cccccc;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            position: relative;
            margin-right: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 41px;
            box-sizing: border-box;
        }
        
        .terminal-tab:hover {
            background: #2a2a2a;
        }
        
        .terminal-tab.active {
            background: #000000;
            color: #ffffff;
            border-color: #555555;
        }
        
        .terminal-tab .tab-title {
            padding: 8px 12px;
            flex: 1;
            display: flex;
            align-items: center;
            height: 100%;
        }
        
        .terminal-tab-close {
            margin-right: 8px;
            color: #888888;
            font-weight: bold;
            cursor: pointer;
            padding: 8px 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            line-height: 1;
            font-size: 20px;
            width: 24px;
            flex-shrink: 0;
        }
        
        .terminal-tab-close:hover {
            color: #ffffff;
        }
        
        .terminal-content {
            position: relative;
            height: calc(100% - 41px);
            padding-top: 3px;
            overflow: hidden;
        }
        
        .terminal-content > div {
            height: 100%;
        }
        
        .terminal-content .terminal {
            width: 100%;
            height: 100%;
        }

        /* Responsive Terminal Font */
        @media (max-width: 768px) {
            #terminal {
                font-size: 11px;
            }
            
            .terminal-tab {
                height: 36px;
                font-size: 11px;
            }
            
            .terminal-tab .tab-title {
                padding: 6px 10px;
            }
            
            .terminal-add-tab-btn {
                padding: 6px 12px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            #terminal {
                font-size: 10px;
            }
            
            .terminal-tab {
                height: 32px;
                font-size: 10px;
            }
            
            .terminal-tab .tab-title {
                padding: 5px 8px;
            }
            
            .terminal-tab-close {
                font-size: 18px;
                width: 20px;
            }
            
            .terminal-add-tab-btn {
                padding: 5px 10px;
                font-size: 12px;
            }
        }


        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin-right: 6px;
        }

        .status-online {
            background: #00ff00;
        }

        .status-offline {
            background: #666666;
        }

        .server-control {
            display: flex;
            gap: 2%;
            justify-content: space-between;
            margin-top: 2%;
        }

        .control-button {
            background: #222222;
            border: 1px solid #333333;
            color: #ffffff;
            padding: 4px 16px;
            cursor: pointer;
            font-family: 'Courier New', 'Monaco', monospace;
            font-size: 13px;
            transition: all 0.3s ease;
            width: 32%;
            flex: 1;
            min-width: 30%;
            height: auto;
            line-height: 1.2;
        }

        /* Responsive Button Sizing */
        @media (max-width: 768px) {
            .control-button {
                font-size: 12px;
                padding: 6px 14px;
            }
        }

        @media (max-width: 480px) {
            .server-control {
                flex-direction: row;
                gap: 2%;
            }
            
            .control-button {
                font-size: 11px;
                padding: 6px 12px;
                min-width: 0;
            }
        }

        .control-button:hover {
            background: #333333;
            border-color: #666666;
        }

        .shutdown-button {
            background: #440000;
            border-color: #660000;
        }

        .shutdown-button:hover {
            background: #660000;
            border-color: #880000;
        }

        .reboot-button {
            background: #004400;
            border-color: #006600;
        }

        .reboot-button:hover {
            background: #006600;
            border-color: #008800;
        }

        .logout-button {
            background: #333366;
            border-color: #444477;
        }

        .logout-button:hover {
            background: #444477;
            border-color: #555588;
        }

        /* Docker Containers Section */
        .docker-summary {
            display: flex;
            flex-direction: row;
            gap: 2%;
            margin-bottom: 1%;
        }
        
        .docker-summary .metric {
            flex: 1;
            box-sizing: border-box;
        }

        .docker-containers {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333333;
            background: #111111;
        }

        .docker-containers::-webkit-scrollbar {
            width: 8px;
        }

        .docker-containers::-webkit-scrollbar-track {
            background: #111111;
        }

        .docker-containers::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        .docker-containers::-webkit-scrollbar-thumb:hover {
            background: #444444;
        }

        .docker-container {
            display: grid;
            grid-template-columns: minmax(180px, 200px) minmax(300px, 2.5fr) minmax(165px, 180px) minmax(170px, 190px);
            padding: 8px 12px;
            border-bottom: 1px solid #222222;
            align-items: center;
            font-size: 12px;
            min-width: 1115px;
        }

        .docker-container > div {
            padding: 6px 8px;
            border-right: 1px solid #333333;
        }

        .docker-container > div:last-child {
            border-right: none;
        }

        .docker-container:last-child {
            border-bottom: none;
        }

        .docker-container:hover {
            background: #222222;
        }

        .docker-header {
            display: grid;
            grid-template-columns: minmax(180px, 200px) minmax(300px, 2.5fr) minmax(165px, 180px) minmax(170px, 190px);
            padding: 8px 12px;
            background: #333333;
            font-weight: bold;
            font-size: 12px;
            border-bottom: 2px solid #444444;
            min-width: 965px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .docker-header > div {
            padding: 6px 8px;
            border-right: 1px solid #555555;
        }

        .docker-header > div:last-child {
            border-right: none;
        }

        .docker-name {
            color: #ffffff;
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .docker-image {
            color: #cccccc;
            font-family: 'Courier New', 'Monaco', monospace;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .docker-uptime {
            color: #cccccc;
            font-size: 11px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-align: left;
        }
        

        .docker-controls {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            align-items: center;
        }

        .docker-btn {
            padding: 2px 10px;
            font-size: 11px;
            border: 1px solid #333333;
            background: #222222;
            color: #ffffff;
            cursor: pointer;
            white-space: nowrap;
        }

        .docker-btn:hover {
            background: #333333;
            border-color: #444444;
        }

        .docker-btn.start {
            background: #004400;
            border-color: #006600;
        }

        .docker-btn.start:hover {
            background: #006600;
        }

        .docker-btn.stop {
            background: #440000;
            border-color: #660000;
        }

        .docker-btn.stop:hover {
            background: #660000;
        }

        .docker-btn.restart {
            background: #444400;
            border-color: #666600;
        }

        .docker-btn.restart:hover {
            background: #666600;
        }

        /* Responsive Docker Section */
        @media (max-width: 768px) {
            .docker-summary {
                grid-template-columns: repeat(3, 1fr);
                gap: 2%;
            }
            
            .docker-containers {
                overflow-x: auto;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-width: 480px) {
            .docker-btn {
                padding: 2px 8px;
                font-size: 10px;
            }
        }
        
        /* ==========================================
           COMPREHENSIVE MOBILE RESPONSIVENESS
           ========================================== */
        
        /* Base font and sizing adjustments for mobile */
        html {
            font-size: 16px;
        }
        
        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }
        }
        
        /* Touch target optimization - minimum 44x44px for mobile */
        .docker-btn,
        .terminal-tab,
        .terminal-add-tab-btn {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Control buttons (SERVER CONTROL) - separate styling */
        .control-button {
            min-height: auto;
        }
        
        @media (min-width: 769px) {
            /* Desktop buttons - reduced height */
            .docker-btn {
                min-height: auto;
            }
        }
        
        @media (max-width: 480px) {
            .docker-btn {
                padding: 12px 16px;
                font-size: 14px;
            }
            
            /* Control buttons keep smaller padding on mobile */
            .control-button {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
        
        /* Prevent text selection issues on mobile */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        /* Improve scrolling on mobile */
        body {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        
        /* Optimize images and containers for mobile */
        img {
            max-width: 100%;
            height: auto;
        }
        
        /* Ensure no horizontal overflow */
        .container {
            overflow-x: hidden;
        }
        
        /* Improve card readability on mobile */
        .metric {
            word-break: break-word;
            hyphens: auto;
        }
        
        /* Mobile-specific metric adjustments */
        @media (max-width: 480px) {
            .metric {
                flex-wrap: wrap;
                padding: 6px;
                margin-bottom: 6px;
                font-size: 0.875rem;
            }
            
            .metric-label, .metric-value {
                font-size: 0.875rem;
            }
        }
        
        /* Progress bar mobile optimization */
        .progress-bar {
            min-height: 8px;
        }
        
        @media (max-width: 480px) {
            .progress-bar {
                min-height: 6px;
            }
        }
        
        /* Button text should not wrap on very small screens */
        @media (max-width: 360px) {
            .docker-btn {
                font-size: 12px;
                padding: 10px 12px;
                white-space: nowrap;
            }
            
            /* Control buttons - separate styling for very small screens */
            .control-button {
                font-size: 11px;
                padding: 8px 12px;
                white-space: nowrap;
            }
        }
        
        /* Ensure proper spacing for all interactive elements */
        @media (max-width: 480px) {
            .card {
                margin-bottom: 10px;
            }
        }
        
        /* Terminal specific mobile optimizations */
        @media (max-width: 480px) {
            .terminal-container {
                padding: 8px;
            }
            
            .terminal-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .terminal-tab {
                flex-shrink: 0;
                height: 32px;
            }
            
            .terminal-tab .tab-title {
                padding: 6px 8px;
            }
            
            .terminal-tabs-container {
                min-width: min-content;
            }
        }
        
        /* Prevent horizontal scroll on mobile */
        @media (max-width: 480px) {
            * {
                max-width: 100vw;
            }
        }
        
        /* Improve table/list scrolling on mobile */
        .docker-containers {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Small cards responsive breakpoint adjustments */
        @media (max-width: 600px) {
            .small-cards-container {
                gap: 12px;
            }
        }
        
        /* Font size adjustments for better readability on small screens */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.3rem;
            }
            
            .card h2 {
                font-size: 0.95rem;
            }
            
            .metric-label, .metric-value {
                font-size: 0.8rem;
            }
        }
        
        /* Line height adjustments for better text readability */
        @media (max-width: 480px) {
            body {
                line-height: 1.5;
            }
            
            .metric {
                line-height: 1.6;
            }
        }
        
        
        /* Container padding optimization for mobile */
        @media (max-width: 360px) {
            .container {
                padding: 8px;
            }
            
            .card {
                padding: 10px;
            }
        }
        
        /* Prevent layout shift on mobile */
        img, video, iframe {
            display: block;
        }
        
        /* Loading states should not cause horizontal scroll */
        @media (max-width: 480px) {
            #os-info, #uptime, #hostname, 
            #cpu-usage, #memory-used, #disk-used,
            #load-average, #cpu-temp {
                word-break: break-all;
                overflow-wrap: break-word;
            }
        }
        
        /* Ensure proper display of status indicators */
        @media (max-width: 480px) {
            .status-indicator {
                width: 6px;
                height: 6px;
            }
        }
        
        /* Server control buttons should stack on mobile */
        .server-control {
            flex-wrap: wrap;
        }
        
        @media (max-width: 480px) {
            .server-control {
                gap: 10px;
            }
            
            .control-button {
                flex: 1 1 100%;
                margin-bottom: 5px;
            }
        }
        
        /* Summary sections should stack on mobile */
        .docker-summary {
            gap: 10px;
        }
        
        @media (max-width: 480px) {
            .docker-summary {
                gap: 8px;
            }
        }
        
        /* Prevent overflow in container names */
        .docker-name {
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        @media (max-width: 480px) {
            .docker-name {
                font-size: 0.85rem;
            }
        }
        
        /* Optimize terminal for landscape on mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .terminal-container {
                height: 30vh;
                min-height: 200px;
            }
        }
        
        @media (max-width: 480px) and (orientation: landscape) {
            .terminal-container {
                height: 25vh;
                min-height: 150px;
            }
        }
        
        /* File Manager Styles */
        .file-manager-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            align-items: center;
        }

        .file-manager-btn {
            padding: 6px 12px;
            background: #222222;
            border: 1px solid #333333;
            color: #ffffff;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Courier New', 'Monaco', monospace;
            transition: all 0.3s ease;
            min-width: 40px;
        }

        .file-manager-btn:hover {
            background: #333333;
            border-color: #555555;
        }

        .file-path-input {
            flex: 1;
            padding: 6px 12px;
            background: #222222;
            border: 1px solid #333333;
            color: #ffffff;
            font-family: 'Courier New', 'Monaco', monospace;
            font-size: 12px;
        }

        .file-path-input:focus {
            outline: none;
            border-color: #555555;
        }

        .file-manager-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333333;
            background: #111111;
        }

        .file-manager-list::-webkit-scrollbar {
            width: 8px;
        }

        .file-manager-list::-webkit-scrollbar-track {
            background: #111111;
        }

        .file-manager-list::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        .file-manager-list::-webkit-scrollbar-thumb:hover {
            background: #444444;
        }

        .file-item {
            display: grid;
            grid-template-columns: 30px 1fr 100px 80px 100px 150px;
            padding: 8px 12px;
            border-bottom: 1px solid #222222;
            align-items: center;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: #222222;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-icon {
            text-align: center;
            font-size: 16px;
        }

        .file-name {
            color: #ffffff;
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-size {
            color: #cccccc;
            text-align: right;
        }

        .file-type {
            color: #888888;
            font-size: 10px;
            text-transform: uppercase;
        }

        .file-owner {
            color: #999999;
            font-size: 11px;
        }

        .file-modified {
            color: #999999;
            font-size: 11px;
        }

        .file-header {
            display: grid;
            grid-template-columns: 30px 1fr 100px 80px 100px 150px;
            padding: 8px 12px;
            background: #333333;
            font-weight: bold;
            font-size: 12px;
            border-bottom: 2px solid #444444;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Security Dashboard Styles */
        .security-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 15px;
            border-bottom: 1px solid #333333;
        }

        .security-tab {
            padding: 8px 16px;
            background: #222222;
            border: 1px solid #333333;
            border-bottom: none;
            color: #cccccc;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Courier New', 'Monaco', monospace;
            transition: all 0.3s ease;
        }

        .security-tab:hover {
            background: #2a2a2a;
            border-color: #555555;
        }

        .security-tab.active {
            background: #000000;
            color: #ffffff;
            border-color: #555555;
        }

        .security-content {
            border: 1px solid #333333;
            background: #111111;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
        }

        .security-content::-webkit-scrollbar {
            width: 8px;
        }

        .security-content::-webkit-scrollbar-track {
            background: #111111;
        }

        .security-content::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        .security-content::-webkit-scrollbar-thumb:hover {
            background: #444444;
        }

        .security-item {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 120px;
            padding: 10px 12px;
            border-bottom: 1px solid #222222;
            align-items: center;
            font-size: 12px;
        }

        .security-item:last-child {
            border-bottom: none;
        }

        .security-item:hover {
            background: #222222;
        }

        .security-header {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 120px;
            padding: 10px 12px;
            background: #333333;
            font-weight: bold;
            font-size: 12px;
            border-bottom: 2px solid #444444;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .security-terminate-btn {
            padding: 4px 10px;
            background: #440000;
            border: 1px solid #660000;
            color: #ffffff;
            cursor: pointer;
            font-size: 11px;
            font-family: 'Courier New', 'Monaco', monospace;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .security-terminate-btn:hover {
            background: #660000;
            border-color: #880000;
        }

        .security-value {
            color: #ffffff;
        }

        .security-label {
            color: #cccccc;
            font-size: 10px;
            text-transform: uppercase;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .file-header,
            .file-item {
                grid-template-columns: 30px 1fr 80px;
                font-size: 11px;
            }

            .file-size,
            .file-type,
            .file-owner,
            .file-modified {
                display: none;
            }

            .security-item,
            .security-header {
                grid-template-columns: 2fr 1fr;
                font-size: 11px;
            }
        }

    </style>
</head>
<body>
    <!-- ==========================================
         PAGE STRUCTURE
         ========================================== -->
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>SERVER ADMINISTRATION</h1>
        </div>

        <div class="dashboard">
            <!-- ==========================================
                 TERMINAL SECTION
                 ========================================== -->
            <div class="card terminal-section">
                <h2>ROOT TERMINAL</h2>
                <div class="terminal-container">
                    <div class="terminal-tabs">
                        <div class="terminal-tabs-container" id="terminal-tabs"></div>
                        <button class="terminal-add-tab-btn" onclick="window.createNewTerminal()" title="New Terminal (Ctrl+T)">+</button>
                        <button class="terminal-fullscreen-btn" onclick="enterFullscreenTerminal()" title="Fullscreen Terminal">⛶</button>
                    </div>
                    <div class="terminal-content" id="terminal-content"></div>
                </div>
            </div>

            <!-- ==========================================
                 SMALL CARDS SECTION (System Overview, CPU, Memory, Disk)
                 ========================================== -->
            <div class="small-cards-container">
                <!-- System Overview Card -->
                <div class="card">
                    <h2>SYSTEM OVERVIEW</h2>
                    <div class="metric">
                        <span class="metric-label">OS</span>
                        <span class="metric-value" id="os-info">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Uptime</span>
                        <span class="metric-value" id="uptime">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Hostname</span>
                        <span class="metric-value" id="hostname">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span class="metric-value">
                            <span class="status-indicator status-online"></span>
                            Online
                        </span>
                    </div>
                </div>

                <!-- CPU Usage -->
                <div class="card">
                    <h2>CPU USAGE</h2>
                    <div class="metric">
                        <span class="metric-label">CPU Usage</span>
                        <span class="metric-value" id="cpu-usage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cpu-progress" style="width: 0%"></div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Load Average</span>
                        <span class="metric-value" id="load-average">0.00</span>
                    </div>
                </div>

                <!-- Memory Usage -->
                <div class="card">
                    <h2>MEMORY USAGE</h2>
                    <div class="metric">
                        <span class="metric-label">Memory Used</span>
                        <span class="metric-value" id="memory-used">0 GB</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="memory-progress" style="width: 0%"></div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Memory Total</span>
                        <span class="metric-value" id="memory-total">0 GB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Memory Free</span>
                        <span class="metric-value" id="memory-free">0 GB</span>
                    </div>
                </div>

                <!-- Disk Usage -->
                <div class="card">
                    <h2>DISK USAGE</h2>
                    <div class="metric">
                        <span class="metric-label">Disk Used</span>
                        <span class="metric-value" id="disk-used">0 GB</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="disk-progress" style="width: 0%"></div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Disk Total</span>
                        <span class="metric-value" id="disk-total">0 GB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Disk Free</span>
                        <span class="metric-value" id="disk-free">0 GB</span>
                    </div>
                </div>
            </div>

        <!-- Docker Containers -->
        <div class="card">
            <h2>DOCKER CONTAINERS</h2>
            <div class="docker-summary">
                <div class="metric">
                    <span class="metric-label">Total:</span>
                    <span class="metric-value" id="total-containers">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Active:</span>
                    <span class="metric-value" id="running-containers">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Inactive:</span>
                    <span class="metric-value" id="stopped-containers">0</span>
                </div>
            </div>
            <div class="docker-containers" id="docker-containers">
                <!-- Docker containers will be populated here -->
            </div>
        </div>

        <!-- File Manager -->
        <div class="card">
            <h2>FILE MANAGER</h2>
            <div class="file-manager-controls">
                <button class="file-manager-btn" onclick="fileManagerNavigateUp()" title="Go up">⬆</button>
                <button class="file-manager-btn" onclick="fileManagerRefresh()" title="Refresh">⟳</button>
                <input type="text" id="file-manager-path" placeholder="/host/root" class="file-path-input" onkeypress="handlePathInput(event)">
            </div>
            <div class="file-manager-list" id="file-manager-list">
                <div style="padding: 2%; text-align: center; color: #666666;">Loading...</div>
            </div>
        </div>

        <!-- Security Dashboard -->
        <div class="card">
            <h2>SECURITY DASHBOARD</h2>
            <div class="security-tabs">
                <button class="security-tab active" onclick="switchSecurityTab('ssh')">SSH Sessions</button>
                <button class="security-tab" onclick="switchSecurityTab('openvpn')">OpenVPN</button>
                <button class="security-tab" onclick="switchSecurityTab('connections')">Active Connections</button>
            </div>
            <div id="security-content" class="security-content">
                <!-- Security content will be populated here -->
            </div>
        </div>

        <!-- Server Control -->
        <div class="card">
            <h2>SERVER CONTROL</h2>
            <div class="server-control">
                <button class="control-button shutdown-button" onclick="shutdownServer()">SHUTDOWN</button>
                <button class="control-button reboot-button" onclick="rebootServer()">REBOOT</button>
                <button class="control-button logout-button" onclick="logout()">LOGOUT</button>
            </div>
        </div>
    </div>

    <!-- ==========================================
         JAVASCRIPT APPLICATION CODE
         ========================================== -->
    <script>
        // ==========================================
        // GLOBAL VARIABLES & CONFIGURATION
        // ==========================================
        let currentPath = '/host/root';
        let currentSecurityTab = 'ssh';
        
        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatUptime(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${days}d ${hours}h ${minutes}m`;
        }
        
        // Check authentication on page load
        window.addEventListener('load', function() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = '/login';
                return;
            }
            
            // Initialize Socket.IO connection with authentication
            const socket = io({
                auth: {
                    token: token
                }
            });
            
            // Handle authentication errors
            socket.on('connect_error', (error) => {
                if (error.message === 'Authentication failed') {
                    localStorage.removeItem('adminToken');
                    window.location.href = '/login';
                }
            });
            
            initializeApp(socket);
            
            // Load initial data for file manager and security
            loadFileManager();
            loadSecurityData('ssh');
            
            // Set up periodic updates for file manager and security
            setInterval(loadFileManager, 30000); // Update file manager every 30 seconds
            setInterval(() => loadSecurityData(currentSecurityTab), 15000); // Update security every 15 seconds
        });
        
        function initializeApp(socket) {
        
        // Terminal tabs management
        let terminals = new Map();
        let activeTabId = null;
        let tabCounter = 1;
        let terminalSessionCounter = 0;
        
        // Create terminal tab
        function createTerminalTab() {
            const tabId = `terminal-${tabCounter++}`;
            const tabNumber = tabCounter - 1;
            const sessionId = terminalSessionCounter++;
            
            // Create tab element
            const tabsContainer = document.getElementById('terminal-tabs');
            const tabElement = document.createElement('div');
            tabElement.className = 'terminal-tab active';
            tabElement.id = `tab-${tabId}`;
            tabElement.innerHTML = `
                <span class="tab-title">Terminal ${tabNumber}</span>
                <span class="terminal-tab-close" onclick="closeTab('${tabId}', event)">×</span>
            `;
            tabElement.onclick = (e) => {
                if (e.target.className !== 'terminal-tab-close') {
                    switchTab(tabId);
                }
            };
            tabsContainer.appendChild(tabElement);
            
            // Create terminal instance
            const terminalDiv = document.createElement('div');
            terminalDiv.id = tabId;
            terminalDiv.style.display = activeTabId ? 'none' : 'block';
            
            const terminal = new Terminal({
                theme: {
                    background: '#000000',
                    foreground: '#ffffff',
                    cursor: '#ffffff',
                    selection: '#333333'
                },
                fontSize: 13,
                fontFamily: 'Courier New, Monaco, monospace',
                cols: 120,
                rows: 30,
                scrollback: 1000,
                allowTransparency: false,
                cursorBlink: true,
                cursorStyle: 'block'
            });
            
            const fitAddon = new FitAddon.FitAddon();
            terminal.loadAddon(fitAddon);
            
            document.getElementById('terminal-content').appendChild(terminalDiv);
            terminal.open(document.getElementById(tabId));
            fitAddon.fit();
            
            // Unique session data for this terminal
            let backendSessionConnected = false;
            let backendTerminalId = null;
            
            // Initialize backend session for THIS terminal
            socket.emit('terminal:create', { 
                cols: 120, 
                rows: 30,
                tabId: tabId,
                sessionId: sessionId
            });
            
            // Handle backend response
            socket.once('terminal:created', (data) => {
                if (data && data.tabId === tabId) {
                    backendTerminalId = data.backendId || socket.id;
                    backendSessionConnected = true;
                    terminal.focus();
                }
            });
            
            // Terminal input handler - sends to this terminal's backend session
            terminal.onData(data => {
                if (backendSessionConnected) {
                    socket.emit('terminal:input', {
                        data: data,
                        tabId: tabId,
                        sessionId: sessionId
                    });
                }
            });
            
            // Store terminal with session info
            terminals.set(tabId, { 
                terminal, 
                fitAddon, 
                tabElement, 
                tabId,
                sessionId: sessionId,
                backendTerminalId: backendTerminalId,
                connected: backendSessionConnected
            });
            
            if (!activeTabId) {
                activeTabId = tabId;
            }
            
            return tabId;
        }
        
        // Switch between tabs
        window.switchTab = function(tabId) {
            const oldTab = terminals.get(activeTabId);
            const newTab = terminals.get(tabId);
            
            if (oldTab) {
                oldTab.tabElement.classList.remove('active');
                document.getElementById(activeTabId).style.display = 'none';
            }
            
            if (newTab) {
                newTab.tabElement.classList.add('active');
                document.getElementById(tabId).style.display = 'block';
                activeTabId = tabId;
                newTab.terminal.focus();
                
                // Trigger resize for proper rendering
                setTimeout(() => {
                    newTab.fitAddon.fit();
                    const { cols, rows } = newTab.terminal;
                    socket.emit('terminal:resize', { cols, rows });
                }, 100);
            }
        };
        
        // Close a tab
        window.closeTab = function(tabId, event) {
            event.stopPropagation();
            
            if (terminals.size <= 1) {
                return; // Don't close the last tab
            }
            
            const tab = terminals.get(tabId);
            if (!tab) return;
            
            // If closing active tab, switch to another
            if (activeTabId === tabId) {
                const otherTabs = Array.from(terminals.keys()).filter(id => id !== tabId);
                if (otherTabs.length > 0) {
                    switchTab(otherTabs[0]);
                }
            }
            
            // Clean up
            tab.terminal.dispose();
            document.getElementById(tabId).remove();
            tab.tabElement.remove();
            terminals.delete(tabId);
        };
        
        // Handle keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl+T to create new tab
            if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                createTerminalTab();
            }
        });
        
        // Handle terminal resize for all terminals
        window.addEventListener('resize', () => {
            terminals.forEach(({ terminal, fitAddon }) => {
                fitAddon.fit();
                const { cols, rows } = terminal;
                socket.emit('terminal:resize', { cols, rows });
            });
        });
        
        // Global function to create new terminal from button
        window.createNewTerminal = function() {
            createTerminalTab();
        };
        
        // Global function to enter fullscreen terminal
        window.enterFullscreenTerminal = function() {
            const token = localStorage.getItem('adminToken');
            if (token) {
                window.location.href = `/terminal-fullscreen?token=${token}`;
            } else {
                alert('Session expired. Please login again.');
                window.location.href = '/login';
            }
        };
        
        
        // Socket.IO event handlers - route data to specific terminals
        socket.on('terminal:data', (message) => {
            // message should have tabId to route to correct terminal
            const tabId = message.tabId || activeTabId;
            if (tabId && terminals.has(tabId)) {
                const tab = terminals.get(tabId);
                tab.terminal.write(message.data);
            }
        });
        
        socket.on('terminal:created', (data) => {
            // Update the terminal's backend connection status
            const tabId = data.tabId;
            if (tabId && terminals.has(tabId)) {
                const tab = terminals.get(tabId);
                tab.backendTerminalId = data.backendId || socket.id;
                tab.connected = true;
                if (activeTabId === tabId) {
                    tab.terminal.focus();
                }
            }
        });
        
        socket.on('terminal:exit', (message) => {
            const tabId = message.tabId || activeTabId;
            if (tabId && terminals.has(tabId)) {
                const tab = terminals.get(tabId);
                tab.terminal.write('\r\nTerminal session ended.\r\n');
                tab.connected = false;
            }
        });
        
        // Initialize first terminal
        createTerminalTab();
        
        // Load initial system data
        async function loadSystemData() {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('/api/system', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    localStorage.removeItem('adminToken');
                    window.location.href = '/login';
                    return;
                }
                
                const data = await response.json();
                
                document.getElementById('os-info').textContent = `${data.osInfo.distro} ${data.osInfo.release}`;
                document.getElementById('hostname').textContent = data.osInfo.hostname;
                
                // Format uptime
                const uptimeFormatted = formatUptime(data.osInfo.uptime);
                document.getElementById('uptime').textContent = uptimeFormatted;
                
                // Memory info
                const memUsed = formatBytes(data.memory.used);
                const memTotal = formatBytes(data.memory.total);
                // Calculate free memory as total - used
                const memFree = formatBytes(data.memory.total - data.memory.used);
                const memPercent = ((data.memory.used / data.memory.total) * 100).toFixed(1);
                
                document.getElementById('memory-used').textContent = memUsed;
                document.getElementById('memory-total').textContent = memTotal;
                document.getElementById('memory-free').textContent = memFree;
                document.getElementById('memory-progress').style.width = memPercent + '%';
                
                // Disk info
                if (data.disk.length > 0) {
                    const disk = data.disk[0];
                    const diskUsed = formatBytes(disk.used);
                    const diskTotal = formatBytes(disk.size);
                    const diskFree = formatBytes(disk.available);
                    const diskPercent = ((disk.used / disk.size) * 100).toFixed(1);
                    
                    document.getElementById('disk-used').textContent = diskUsed;
                    document.getElementById('disk-total').textContent = diskTotal;
                    document.getElementById('disk-free').textContent = diskFree;
                    document.getElementById('disk-progress').style.width = diskPercent + '%';
                }
                
                
            } catch (error) {
                console.error('Error loading system data:', error);
            }
        }
        
        // Load Docker containers data
        async function loadDockerData() {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('/api/docker', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    localStorage.removeItem('adminToken');
                    window.location.href = '/login';
                    return;
                }
                
                const data = await response.json();
                
                // Update summary metrics
                document.getElementById('total-containers').textContent = data.totalContainers;
                document.getElementById('running-containers').textContent = data.runningContainers;
                document.getElementById('stopped-containers').textContent = data.stoppedContainers;
                
                // Update containers list
                updateDockerContainers(data.containers);
                
            } catch (error) {
                console.error('Error loading Docker data:', error);
            }
        }
        
        // Get access information for a container
        function getAccessInfo(containerName, ports) {
            const accessMap = {
                'code-server': {
                    web: 'http://192.168.255.1:8080',
                    cli: 'docker exec -it code-server bash'
                },
                'jellyfin': {
                    web: 'http://192.168.255.1:8096',
                    cli: 'docker exec -it jellyfin bash'
                },
                'ollama': {
                    web: 'http://192.168.255.1:11434',
                    api: 'curl http://localhost:11434/api/tags',
                    cli: 'docker exec -it ollama ollama run llama2'
                },
                'pihole': {
                    web: 'http://192.168.255.1:81',
                    cli: 'docker exec -it pihole bash'
                },
                'openvpn-server': {
                    web: 'N/A',
                    cli: 'docker exec -it openvpn-server bash'
                },
                'system-monitor': {
                    web: 'http://192.168.255.1:3000',
                    cli: 'docker exec -it system-monitor bash'
                },
                'FRC10951-SITE': {
                    web: 'http://192.168.255.1:3001',
                    cli: 'docker exec -it FRC10951-SITE bash'
                },
                'GENERAL-SITE': {
                    web: 'http://192.168.255.1:3002',
                    cli: 'docker exec -it GENERAL-SITE bash'
                },
                'obsidian-backup-server': {
                    web: 'N/A',
                    cli: 'docker start obsidian-backup-server'
                }
            };
            
            const accessInfo = accessMap[containerName] || {};
            let result = '<div style="font-size: 11px; line-height: 1.4;">';
            
            // Display web URL if available
            if (accessInfo.web) {
                if (accessInfo.web === 'N/A') {
                    result += '<span style="color: #666;">No web access</span>';
                } else {
                    result += `<a href="${accessInfo.web}" target="_blank" style="color: #4CAF50; text-decoration: none; word-break: break-all;">${accessInfo.web}</a>`;
                }
            }
            
            // Display CLI command
            if (accessInfo.cli) {
                result += `<br><span style="color: #999; font-family: monospace; font-size: 10px;">${accessInfo.cli}</span>`;
            } else if (accessInfo.api) {
                result += `<br><span style="color: #999; font-family: monospace; font-size: 10px;">${accessInfo.api}</span>`;
            }
            
            // If no specific mapping, show ports
            if (!accessInfo.web && !accessInfo.cli && ports && ports !== 'No ports') {
                result += `<span style="color: #888; font-family: monospace;">${ports.substring(0, 50)}</span>`;
            } else if (!accessInfo.web && !accessInfo.cli) {
                result += '<span style="color: #666;">No access info</span>';
            }
            
            result += '</div>';
            return result;
        }
        
        // Update Docker containers display
        function updateDockerContainers(containers) {
            const container = document.getElementById('docker-containers');
            
            if (containers.length === 0) {
                container.innerHTML = '<div style="padding: 2%; text-align: center; color: #666666;">No Docker containers found</div>';
                return;
            }
            
            // Create header
            const header = document.createElement('div');
            header.className = 'docker-header';
            header.innerHTML = `
                <div>Name</div>
                <div>Access</div>
                <div>Uptime</div>
                <div>Controls</div>
            `;
            
            // Create container rows
            const containerRows = containers.map(container => {
                // Show uptime if running, "Inactive" if stopped
                let uptimeDisplay = container.status.includes('Up') ? container.uptime : 'Inactive';
                // Remove health status from uptime display
                uptimeDisplay = uptimeDisplay.replace(/\s*\(healthy\).*/i, '');
                uptimeDisplay = uptimeDisplay.replace(/\s*\(unhealthy\).*/i, '');
                
                // Determine which buttons to show based on status
                const isRunning = container.status.includes('Up');
                let buttons = '';
                
                if (isRunning) {
                    buttons = `
                        <button class="docker-btn stop" onclick="controlContainer('${container.name}', 'stop')">Stop</button>
                        <button class="docker-btn restart" onclick="controlContainer('${container.name}', 'restart')">Restart</button>
                    `;
                } else {
                    buttons = `
                        <button class="docker-btn start" onclick="controlContainer('${container.name}', 'start')">Start</button>
                    `;
                }
                
                // Get access info based on container name/ports
                const accessInfo = getAccessInfo(container.name, container.ports);
                
                return `
                    <div class="docker-container">
                        <div class="docker-name">${container.name}</div>
                        <div class="docker-image">${accessInfo}</div>
                        <div class="docker-uptime">${uptimeDisplay}</div>
                        <div class="docker-controls">
                            ${buttons}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = header.outerHTML + containerRows;
        }
        // Real-time updates via WebSocket
        socket.on('system:update', (data) => {
            try {
                // CPU usage - backend sends load.currentload (lowercase)
                if (data && data.load && data.load.currentload !== undefined) {
                    const cpuPercent = parseFloat(data.load.currentload).toFixed(1);
                    document.getElementById('cpu-usage').textContent = cpuPercent + '%';
                    document.getElementById('cpu-progress').style.width = cpuPercent + '%';
                }
                
                // Load average - backend sends load.currentload_user
                if (data && data.load && data.load.currentload_user !== undefined) {
                    const loadAvg = parseFloat(data.load.currentload_user).toFixed(2);
                    document.getElementById('load-average').textContent = loadAvg;
                }
                
                // Memory usage - backend sends memory.total, memory.used, memory.free
                if (data && data.memory) {
                    if (data.memory.used !== undefined && data.memory.total !== undefined) {
                        const memPercent = ((data.memory.used / data.memory.total) * 100).toFixed(1);
                        document.getElementById('memory-progress').style.width = memPercent + '%';
                        
                        // Update memory used
                        const memUsed = formatBytes(data.memory.used);
                        document.getElementById('memory-used').textContent = memUsed;
                        
                        // Calculate and update memory free as total - used
                        const memFree = formatBytes(data.memory.total - data.memory.used);
                        document.getElementById('memory-free').textContent = memFree;
                        
                        // Update memory total
                        const memTotal = formatBytes(data.memory.total);
                        document.getElementById('memory-total').textContent = memTotal;
                    }
                }
                
                // Update uptime - backend sends uptime in seconds
                if (data && data.uptime !== undefined) {
                    const uptimeFormatted = formatUptime(data.uptime);
                    document.getElementById('uptime').textContent = uptimeFormatted;
                }
            } catch (error) {
                console.error('Error processing system update:', error);
            }
        });
        
        // Load initial data
        loadSystemData();
        loadDockerData();
        
        // Set up periodic updates
        setInterval(loadSystemData, 5000); // Update system data every 5 seconds
        setInterval(loadDockerData, 10000); // Update Docker data every 10 seconds
        }
        
        // Container control function (global scope)
        function controlContainer(containerName, action) {
            const password = prompt(`Enter password to ${action} container '${containerName}':`);
            if (password === null) return; // User cancelled
            
            const token = localStorage.getItem('adminToken');
            fetch(`/api/docker/${action}`, { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ 
                    container: containerName,
                    password: password 
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert(`Container '${containerName}' ${action} initiated successfully.`);
                    // Refresh Docker data after a short delay
                    setTimeout(loadDockerData, 2000);
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert(`Failed to ${action} container.`);
            });
        }
        
        // Server control functions (global scope)
        function shutdownServer() {
            const password = prompt('Enter password to shutdown server:');
            if (password === null) return; // User cancelled
            
            const token = localStorage.getItem('adminToken');
            fetch('/api/shutdown', { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ password: password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Server shutdown initiated successfully.');
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to initiate shutdown.');
            });
        }
        
        function rebootServer() {
            const password = prompt('Enter password to reboot server:');
            if (password === null) return; // User cancelled
            
            const token = localStorage.getItem('adminToken');
            fetch('/api/reboot', { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ password: password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Server reboot initiated successfully.');
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to initiate reboot.');
            });
        }
        
        // Logout function (global scope)
        function logout() {
            const token = localStorage.getItem('adminToken');
            if (token) {
                fetch('/api/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                }).catch(error => {
                    console.error('Logout error:', error);
                });
            }
            localStorage.removeItem('adminToken');
            window.location.href = '/login';
        }
        
        // File Manager functionality
        async function loadFileManager() {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch(`/api/files?path=${encodeURIComponent(currentPath)}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    localStorage.removeItem('adminToken');
                    window.location.href = '/login';
                    return;
                }
                
                const data = await response.json();
                updateFileManager(data);
                
            } catch (error) {
                console.error('Error loading file manager:', error);
            }
        }
        
        function updateFileManager(data) {
            const container = document.getElementById('file-manager-list');
            document.getElementById('file-manager-path').value = data.path;
            
            if (data.files.length === 0) {
                container.innerHTML = '<div style="padding: 2%; text-align: center; color: #666666;">Directory is empty</div>';
                return;
            }
            
            const header = `
                <div class="file-header">
                    <div>Type</div>
                    <div>Name</div>
                    <div>Size</div>
                    <div>Type</div>
                    <div>Owner</div>
                    <div>Modified</div>
                </div>
            `;
            
            const items = data.files.map(file => {
                const icon = file.type === 'directory' ? '📁' : '📄';
                return `
                    <div class="file-item" onclick="navigateFile('${file.path}', '${file.type}')">
                        <div class="file-icon">${icon}</div>
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${file.size}</div>
                        <div class="file-type">${file.type}</div>
                        <div class="file-owner">${file.owner}</div>
                        <div class="file-modified">${file.modified}</div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = header + items;
        }
        
        function navigateFile(filePath, type) {
            if (type === 'directory') {
                currentPath = filePath;
                loadFileManager();
            }
        }
        
        function fileManagerNavigateUp() {
            const path = currentPath.split('/').slice(0, -1).join('/') || '/host';
            currentPath = path;
            loadFileManager();
        }
        
        function fileManagerRefresh() {
            loadFileManager();
        }
        
        function handlePathInput(event) {
            if (event.key === 'Enter') {
                const path = event.target.value;
                if (path) {
                    currentPath = path;
                    loadFileManager();
                }
            }
        }
        
        // Security Dashboard functionality
        async function loadSecurityData(tab) {
            try {
                const container = document.getElementById('security-content');
                container.innerHTML = '<div style="padding: 2%; text-align: center; color: #888888;">Loading...</div>';
                
                const token = localStorage.getItem('adminToken');
                let response;
                
                if (tab === 'ssh') {
                    response = await fetch('/api/security/ssh', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                } else if (tab === 'openvpn') {
                    response = await fetch('/api/security/openvpn', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                } else if (tab === 'connections') {
                    response = await fetch('/api/security/connections', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                }
                
                if (!response.ok) {
                    console.error(`Security API error: ${response.status} ${response.statusText}`);
                    container.innerHTML = `<div style="padding: 2%; text-align: center; color: #ff6666;">Error loading data (${response.status})</div>`;
                    return;
                }
                
                if (response.status === 401) {
                    localStorage.removeItem('adminToken');
                    window.location.href = '/login';
                    return;
                }
                
                const data = await response.json();
                console.log(`Security data for ${tab}:`, data);
                
                // Additional debugging for OpenVPN
                if (tab === 'openvpn') {
                    console.log('OpenVPN clients:', data.clients);
                    console.log('Total clients:', data.total);
                }
                
                updateSecurityDisplay(tab, data);
                
            } catch (error) {
                console.error('Error loading security data:', error);
                const container = document.getElementById('security-content');
                container.innerHTML = `<div style="padding: 2%; text-align: center; color: #ff6666;">Error: ${error.message}</div>`;
            }
        }
        
        function updateSecurityDisplay(tab, data) {
            const container = document.getElementById('security-content');
            
            if (tab === 'ssh') {
                if (!data.sessions || data.sessions.length === 0) {
                    container.innerHTML = '<div style="padding: 2%; text-align: center; color: #666666;">No active SSH sessions</div>';
                    return;
                }
                
                const header = `
                    <div class="security-header">
                        <div>User</div>
                        <div>IP Address</div>
                        <div>Duration</div>
                        <div>Actions</div>
                    </div>
                `;
                
                const items = data.sessions.map((session, index) => `
                    <div class="security-item">
                        <div class="security-value">${session.user}</div>
                        <div class="security-value">${session.ip}</div>
                        <div class="security-value">${session.sessionDuration}</div>
                        <div>
                            <button class="security-terminate-btn" onclick="terminateSSHSession('${session.user}', '${session.tty}')">Terminate</button>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = header + items;
                
            } else if (tab === 'openvpn') {
                if (!data.clients || data.clients.length === 0) {
                    container.innerHTML = '<div style="padding: 2%; text-align: center; color: #666666;">No active OpenVPN clients</div>';
                    return;
                }
                
                const header = `
                    <div class="security-header">
                        <div>Client</div>
                        <div>IP Address</div>
                        <div>Duration</div>
                        <div>Actions</div>
                    </div>
                `;
                
                const items = data.clients.map(client => {
                    // Ensure client data is valid
                    const clientName = client.clientName || 'Unknown';
                    const ip = client.ip || 'Unknown';
                    const duration = client.duration || 'Unknown';
                    
                    return `
                        <div class="security-item">
                            <div class="security-value">${clientName}</div>
                            <div class="security-value">${ip}</div>
                            <div class="security-value">${duration}</div>
                            <div>
                                <button class="security-terminate-btn" onclick="terminateOpenVPNClient('${clientName}')">Terminate</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = header + items;
                
            } else if (tab === 'connections') {
                if (data.connections.length === 0) {
                    container.innerHTML = '<div style="padding: 2%; text-align: center; color: #666666;">No active connections</div>';
                    return;
                }
                
                const header = `
                    <div class="security-header">
                        <div>Description</div>
                        <div>Local</div>
                        <div>Peer</div>
                        <div>State</div>
                    </div>
                `;
                
                const items = data.connections.map(conn => `
                    <div class="security-item">
                        <div class="security-value">${conn.description || 'Unknown'}</div>
                        <div class="security-value">${conn.local}</div>
                        <div class="security-value">${conn.peer || 'N/A'}</div>
                        <div class="security-value">${conn.state}</div>
                    </div>
                `).join('');
                
                container.innerHTML = header + items;
            }
        }
        
        function switchSecurityTab(tab) {
            currentSecurityTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.security-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadSecurityData(tab);
        }
        
        // Terminate SSH session
        function terminateSSHSession(user, tty) {
            if (!confirm(`Terminate SSH session for user '${user}' on ${tty}?`)) {
                return;
            }
            
            const password = prompt('Enter password to terminate SSH session:');
            if (password === null) return;
            
            const token = localStorage.getItem('adminToken');
            fetch('/api/security/ssh/terminate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ user, tty, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('SSH session terminated successfully.');
                    loadSecurityData('ssh');
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to terminate SSH session.');
            });
        }
        
        // Terminate OpenVPN client
        function terminateOpenVPNClient(clientName) {
            if (!confirm(`Disconnect OpenVPN client '${clientName}'?`)) {
                return;
            }
            
            const password = prompt('Enter password to disconnect OpenVPN client:');
            if (password === null) return;
            
            const token = localStorage.getItem('adminToken');
            fetch('/api/security/openvpn/terminate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ clientName, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('OpenVPN client disconnected successfully.');
                    loadSecurityData('openvpn');
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to disconnect OpenVPN client.');
            });
        }
    </script>
</body>
</html>